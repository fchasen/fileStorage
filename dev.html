<!DOCTYPE html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>FileStorage Test</title>
        <meta name="description" content="">


        <!-- <link rel="stylesheet" href="css/main.css"> -->
        
        <!-- FileStorage min -->
        <script>
            var fileStorage = fileStorage || {};
        </script>
        
        <script src="src/core.js"></script>
        <script src="src/queue.js"></script>
        <script src="src/storage_filesystem.js"></script>
        <script src="src/storage_indexeddb.js"></script>
        <script src="src/storage_none.js"></script>
        <script src="src/storage_ram.js"></script>
        <script src="src/storage_websql.js"></script>
        <script src="src/storage.js"></script>
                
        <script>
            "use strict";
            
            fileStorage.filePath = "/src/";
            
            document.onreadystatechange = function () {  
              if (document.readyState == "complete") {
                
                var iframe = document.querySelector('iframe');
                   
                //-- Simple events
                var evt = new CustomEvent("stored");
                
                //-- Test auto picking
                var store = new fileStorage.storage();
                
                store.batch(["/tests/testpage.html", "/imgs/logo.png"], function() {
                  iframe.dispatchEvent(evt);
                });
                
                iframe.addEventListener("stored", function() {
                    
                    store.get("/tests/testpage.html", function(url) {
                      iframe.src = url;
                    });
                    
                }, false);
               
                iframe.onload = function() {
                    var srcs, resources;
                    
                    if(store.getStorageType() == "filesystem") return;
                    
                    srcs = iframe.contentDocument.querySelectorAll('[src]');
                    resources = Array.prototype.slice.call(srcs);

                    resources.forEach(function(item){
                      var src = item.getAttribute("src");

                      store.get(src, function(url){
                        item.setAttribute("src", url);
                      });
                    
                    });
                }
                                 
              }  
            };
        
          </script>
                
        
        

        
    </head>
    <body>
        <div id="controls">

        </div>
        <h1>fileStorage Test</h1>
        <iframe width='800' height='300'></iframe>
    </body>
</html>
